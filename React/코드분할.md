리액트는 SPA이기 때문에 첫 페이지에 진입할 때, 프로젝트에서 사용하는 모든 외부 모듈과 자바스크립트 파일을 받아온다.
하지만 첫 페이지와 관련없는 코드들까지 모두 받아오는 것은 초기 로딩을 느리게 할 수 있기 때문에 효율적이지 못하다.  
이때 사용할 수 있는 최적화 기법이 **코드 분할**이다.

## 코드 분할

코드 분할을 하기 위한 방법에는 **동적 import**가 있다.

```js
import { a } from "b";

// 동적 import
import("b").then((module) => {
  const { a } = module;

  a();
});
```

동적 import 구문을 만나면 webpack은 코드를 분할하여 번들링하며, 빌드할 때가 아닌 런타임에 로드된다. 이를 지연로딩이라고 한다.

| 코드분할 전                                                                                                                                               | 코드분할 후                                                                                                                                               |
| --------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <img width="331" alt="스크린샷 2024-01-04 오후 2 29 59" src="https://github.com/imzeze/TIL/assets/67260437/4c978844-2e39-49f5-b420-bd65691bb4d2"> | <img width="338" alt="스크린샷 2024-01-04 오후 2 23 56" src="https://github.com/imzeze/TIL/assets/67260437/321dc89e-6044-4fd3-8c4b-227a56976d08"> |

하지만 동적 import는 promise를 리턴한다는 단점이 있는데, 이를 해결하기 위해 리액트에서는 `lazy`와 `<Suspense>`를 제공한다.

## Lazy와 Suspense

```js
const ListPage = React.lazy(() => import("./ListPage"));
const DetailPage = React.lazy(() => import("./DetailPage"));

return (
  <Suspense fallback={<div>loading</div>}>
    <ListPage />
    <DetailPage />
  </Suspense>
);
```

`lazy` 함수는 promise를 리턴하는 함수를 인자로 받고, `<Suspence>`는 이 컴포넌트를 렌더링한다.
이로써 컴포넌트들은 사용자가 해당 컴포넌트에 접근할 때 해당 컴포넌트에 해당하는 코드들만 동적으로 import된다.
